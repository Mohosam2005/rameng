<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع المهندسين المتحد</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>مرحبًا بكم في موقع المهندسين المتحد</h1>
        <p>موقع لرفع ومشاركة المشاريع والتصميمات الهندسية</p>
    </header>

    <main>
        <section id="upload-section">
            <h2>رفع مشروع جديد</h2>
            <form id="upload-form">
                <input type="file" id="file-input" accept=".pdf, .jpg, .png, .zip">
                <button type="submit">رفع المشروع</button>
            </form>
        </section>

        <section id="projects-section">
            <h2>المشاريع المرفوعة</h2>
            <div id="projects-list">
                <!-- سيتم عرض المشاريع هنا -->
            </div>
        </section>
    </main>

    <footer>
        <p>جميع الحقوق محفوظة &copy; 2023 - TechnoEdge</p>
    </footer>

    <script type="module">
        // استيراد الوحدات اللازمة من Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-analytics.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-storage.js";

        // تكوين Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBjZLQBp3Dpi3nvG0Q2Fr0iqS5lZcFRlx8",
            authDomain: "eng22-974f3.firebaseapp.com",
            projectId: "eng22-974f3",
            storageBucket: "eng22-974f3.appspot.com", // تم تصحيح storageBucket
            messagingSenderId: "910411844599",
            appId: "1:910411844599:web:f987ad7133fe5d1f5f7cf2",
            measurementId: "G-17H0EGX0QW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const storage = getStorage(app); // تهيئة Firebase Storage

        // رفع الملفات
        document.getElementById('upload-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];

            if (file) {
                const storageRef = ref(storage, 'projects/' + file.name);

                try {
                    // رفع الملف إلى Firebase Storage
                    const snapshot = await uploadBytes(storageRef, file);
                    
                    // الحصول على رابط التنزيل
                    const downloadURL = await getDownloadURL(snapshot.ref);
                    
                    // عرض المشروع في الصفحة
                    displayProject(file.name, downloadURL);
                } catch (error) {
                    console.error('Error uploading file:', error);
                    alert('حدث خطأ أثناء رفع الملف!');
                }
            } else {
                alert('يرجى اختيار ملف أولاً!');
            }
        });

        // عرض المشاريع
        function displayProject(name, url) {
            const projectsList = document.getElementById('projects-list');
            const projectItem = document.createElement('div');
            projectItem.className = 'project-item';
            projectItem.innerHTML = `
                <h3>${name}</h3>
                <a href="${url}" target="_blank">عرض الملف</a>
            `;
            projectsList.appendChild(projectItem);
        }
    </script>
</body>
</html>